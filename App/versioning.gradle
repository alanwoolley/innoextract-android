ext {
    buildVersionCode = {

        def splits = version.toLowerCase().split('-')
        def (major, minor, patch) = splits[0].tokenize('.')
        def build = 0

        if (splits.size() > 1) {
            build = Integer.parseInt(splits[1].replaceAll("[\\D]", ""))
        } else {
            build = 9
        }

        (major, minor, patch) = [major, minor, patch].collect{it.toInteger()}

        // This was the previous maximum version used under the old scheme.
        // We need to make sure we're greater than this to allow upgrades.
        def previousMax = 400302000 - 400001
        (major * 100000) + (minor * 1000) + (patch * 10) + build + previousMax
    }
}